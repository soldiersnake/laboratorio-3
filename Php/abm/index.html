<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario BBDD</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="contenedor">
        <header>
            <h2>ABM form's - Pokemon</h2>
            <div id="botones">

                <!-- <input type="text" readonly id="orden" value="Precio"> -->
                <button class="btnHeader" id="cargar">Cargar</button>
                <button class="btnHeader" id="vaciar">Vaciar</button>
                <button class="btnHeader" id="limpiarFiltros">Limpiar</button>
                <button class="btnHeader" id="alta">Alta</button>
            </div>
        </header>
        <table>
            <thead>
                <tr>
                    <th campo-dato="id" class="th" id="thId">ID</th>
                    <!-- <th campo-dato="description" class="th" id="thDescription">Descripcion</th> -->
                    <th campo-dato="nombre" class="th" id="thNombre">Nombre</th>
                    <th campo-dato="tipo" class="th" id="thTipo">Tipo</th>
                    <th campo-dato="ataque" class="th" id="thAtaque">Ataque principal</th>
                    <th campo-dato="debilidad" class="th" id="thPrecio">Debilidad</th>
                    <th campo-dato="pdf" class="th" id="thPdf">Pdf's</th>
                    <th campo-dato="modificacion" class="th" id="thPrecio">Modificacion</th>
                    <th campo-dato="baja" class="th" id="thPrecio">Baja</th>

                    <!-- <th campo-dato="año" class="th" id="thAño">Año</th> -->
                </tr>
                <tr>
                    <td campo-dato="id" class="th"><input id="filtroId" type="text"></td>
                    <!-- <td campo-dato="marca" class="th"  ><input id="filtroDescription" type="text"></td> -->
                    <td campo-dato="nombre" class="th"><input id="filtroNombre" type="text"></td>
                    <td campo-dato="tipo" class="th"><select id="filtroTipo"></select></td>
                    <td campo-dato="ataque" class="th"><input id="filtroAtaque" type="text"></td>
                    <td campo-dato="debilidad" class="th"><input id="filtroDebilidad" type="text"></td>
                    <td campo-dato="pdf" class="th"></td>
                    <td campo-dato="modificacion" class="th"></td>
                    <td campo-dato="baja" class="th"></td>


                    <!-- <td campo-dato="año" class="th" ><input id="filtroFecha" type="text"></td> -->
                </tr>

            </thead>
            <tbody id="tabla">

            </tbody>
        </table>
        <footer>
            <h2>
                Mariano Macias - Laboratorio 3
            </h2>
        </footer>


    </div>

    <!-- VENTANA MODAL -->
    <div class="VentanaModal" id="modal">
        <div class="headerVentanaModal">
            <h3 class="itemMid">Formulario de alta</h3>
            <button class="btnCerrarModal">X</button>
        </div>
        <div class="formulario-modal">
            <form action="" method="get" id="myForm">
                <div class="inputsForm">
                    <label for="nombre">Nombre:</label>
                    <input type="text" id="nombre" name="nombre" required>
                </div>
                <div class="inputsForm">
                    <label for="familia">Tipo:</label>
                    <select name="filtroTipo" id="filtroTipoModal" required>
                        <option value="">Selecciona una opcion</option>

                    </select>
                </div>
                <div class="inputsForm">
                    <label for="ataque">Ataque Principal:</label>
                    <input type="txt" id="ataque" name="ataque" required>
                </div>
                <div class="inputsForm" style="margin-top: 1%;">
                    <label for="debilidad">Debilidad:</label>
                    <input type="text" id="debilidad" name="debilidad" required>
                </div>
                <div class="inputsForm" style="margin-top: 1%;">
                    <label for="pdf">Imagen:</label>
                    <input type="file" id="pdf" name="pdf" required>
                </div>


                <button class="btnForm" type="submit" id="btnEnviar">
                    Enviar
                </button>
            </form>
        </div>
    </div>
</body>

</html>

<script src="../jquery.js"></script>

<script>

    var flag = 0;

    $(document).ready(() => {

        $("#thId").click(() => {
            $("#orden").val("id");
        });
        $("#thDescription").click(() => {
            $("#orden").val("description");
        });
        $("#thMarca").click(() => {
            $("#orden").val("marca");
        });
        $("#thModelo").click(() => {
            $("#orden").val("modelo");
        });
        $("#thPrecio").click(() => {
            $("#orden").val("precio");
        });

        // Realizar la petición AJAX para obtener los tipos
        $.ajax({
            type: "GET",
            url: "salidaJsonFamilias.php",
            success: (respuestaServer) => {
                // Convertir la respuesta en un arreglo de tipos
                const tipos = JSON.parse(respuestaServer);
                // Eliminar duplicados y ordenar los tipos alfabéticamente
                const tiposUnicos = [...new Set(tipos)].sort();
                // Mostrar los tipos en una alerta
                alert("Tipos: " + tiposUnicos.join(", "));
                // Llenar el select del filtroTipo con los tipos únicos
                const filtroTipo = $("#filtroTipo");
                filtroTipo.empty();
                tiposUnicos.forEach((tipo) => {
                    filtroTipo.append($("<option></option>").text(tipo));
                });

                const filtroTipoModal = $("#filtroTipoModal");
                filtroTipoModal.empty();
                tiposUnicos.forEach((tipo) => {
                    filtroTipoModal.append($("<option></option>").text(tipo));
                });

            }
        });

        $("#cargar").click(() => {
            console.log("cargando...");
            $("#tabla").empty();
            $("#tabla").html("<h3><i>Cargando datos...</i></h3>");

            $.ajax({
                type: "GET",
                url: "salidaJsonFamilias.php",
                success: (respuestaServer) => {
                    const opcionesTipo = $("#filtroTipo");
                    opcionesTipo.empty(); // Limpiar las opciones existentes

                    // Agregar las opciones obtenidas del servidor
                    opcionesTipo.append(respuestaServer);
                    alert(respuestaServer);

                    console.log("cargando...");
                    $("#tabla").empty();
                    $("#tabla").html("<h3><i>Cargando datos...</i></h3>");

                    $.ajax({
                        type: "GET",
                        url: "salidaJsonArticulos.php",
                        success: (respuestaServer) => {
                            console.log(respuestaServer);

                            const objJson = JSON.parse(respuestaServer);

                            // Obtener los tipos de la respuesta del servidor
                            const tipos = objJson.map((valor) => valor.tipo);
                            // Eliminar duplicados y ordenar los tipos alfabéticamente
                            const tiposUnicos = [...new Set(tipos)].sort();
                            // Llenar el select del filtroTipo con los tipos únicos
                            const filtroTipo = $("#filtroTipo");
                            filtroTipo.empty();
                            tiposUnicos.forEach((tipo) => {
                                filtroTipo.append($("<option></option>").text(tipo));
                            });

                            $("#tabla").empty();
                            objJson.forEach((valor) => {
                                const objTr = document.createElement("tr");

                                const tdId = document.createElement("td");
                                tdId.innerHTML = valor.id;
                                objTr.appendChild(tdId);
                                const tdNombre = document.createElement("td");
                                tdNombre.innerHTML = valor.nombre;
                                objTr.appendChild(tdNombre);
                                const tdTipo = document.createElement("td");
                                tdTipo.innerHTML = valor.tipo;
                                objTr.appendChild(tdTipo);
                                const tdAtaque = document.createElement("td");
                                tdAtaque.innerHTML = valor.ataque_principal;
                                objTr.appendChild(tdAtaque);
                                const tdDebilidad = document.createElement("td");
                                tdDebilidad.innerHTML = valor.debilidad;
                                objTr.appendChild(tdDebilidad);
                                const tdPdf = document.createElement("td");
                                const botonPdf = document.createElement("button");
                                botonPdf.innerText = "PDF";
                                botonPdf.addEventListener("click", btnPDF);
                                tdPdf.appendChild(botonPdf);
                                objTr.appendChild(tdPdf);

                                const tdModi = document.createElement("td");
                                const botonModi = document.createElement("button");
                                botonModi.innerText = "Modi";
                                botonModi.addEventListener("click", btnModi);
                                tdModi.appendChild(botonModi);
                                objTr.appendChild(tdModi);

                                const tdBaja = document.createElement("td");
                                const botonBaja = document.createElement("button");
                                botonBaja.innerText = "Baja";
                                botonBaja.addEventListener("click", btnBaja);
                                tdBaja.appendChild(botonBaja);
                                objTr.appendChild(tdBaja);

                                $("#tabla").append(objTr);
                            });
                        }
                    });
                }
            });
        });

        // ACCION DE VENTANA MODAL
        $("#alta").click(() => {
            $("#contenedor").addClass("modal-open");
            $("#modal").addClass('.mostrar');
            $("#modal").show();
        });
        $(".btnCerrarModal").click(() => {
            $("#contenedor").removeClass("modal-open");
            $(".VentanaModal").hide();
        });


    });

    $("#vaciar").click(() => {
        $("#tabla").empty();
        flag = 0;
    })
    function btnPDF() {
        // Acción del botón PDF
        console.log("Botón PDF clickeado");
    }
    function btnModi() {
        // Acción del botón Modi
        console.log("Botón Modi clickeado");
    }
    function btnBaja() {
        // Acción del botón Baja
        console.log("Botón Baja clickeado");
    }

</script>